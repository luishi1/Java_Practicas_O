<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>SAMBA DO BRASIL</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .messageArea {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 10px;
            background-color: #f8f9fa;
            margin-bottom: 20px;
        }

        .message {
            padding: 5px 10px;
            border-radius: 15px;
            margin-bottom: 5px;
            max-width: 70%;
            word-wrap: break-word;
        }

        .message.user {
            background-color: #d1e7dd;
            align-self: flex-end;
        }

        .message.other {
            background-color: #f8d7da;
            align-self: flex-start;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">Chat en Vivo</h2>
        <div class="card">
            <div class="card-body">
            
                <div class="messageArea d-flex flex-column" id="messageArea"></div> 
                
                <div class="mb-3">
                    <label for="username" class="form-label">Nombre de usuario:</label>
                    <input type="text" class="form-control" id="username" placeholder="Introduce tu nombre" required>
                </div>
                
                <div class="mb-3">
                    <label for="messageInput" class="form-label">Mensaje:</label>
                    <input type="text" class="form-control" id="messageInput" placeholder="Introduce tu mensaje" required>
                </div>
                
                <button onclick="sendMessage()" class="btn btn-primary mt-3">Enviar</button>
            </div>
        </div>
    </div>
    
    <script>
    
        // Establecer conexión WebSocket
        let socket = new WebSocket("ws://localhost:8080/chat");

        // Manejar conexión abierta
        socket.onopen = function(event) {
            console.log("Conexión establecida");
        };

        // Manejar mensajes recibidos
        socket.onmessage = function(event) {
            let messageArea = document.getElementById("messageArea");
            let messageDiv = document.createElement("div");
            messageDiv.textContent = event.data;
            messageDiv.classList.add("message", "other"); 
            messageArea.appendChild(messageDiv);
            messageArea.scrollTop = messageArea.scrollHeight; 
        };

        // Función para enviar mensajes
        function sendMessage() {
            let username = document.getElementById("username").value;
            let messageInput = document.getElementById("messageInput").value;

            if (username.trim() === '' || messageInput.trim() === '') {
                alert("Por favor, introduce un nombre de usuario y un mensaje.");
                return;
            }

            let fullMessage = `${username}: ${messageInput}`;
            socket.send(fullMessage); // Envía el mensaje a través de WebSocket
            

            let messageDiv = document.createElement("div");
            messageDiv.textContent = fullMessage;
            messageDiv.classList.add("message", "user");
            document.getElementById("messageArea").appendChild(messageDiv);

            document.getElementById("messageInput").value = ''; 
            document.getElementById("messageArea").scrollTop = messageArea.scrollHeight; 
        }
    </script>
</body>
</html>
